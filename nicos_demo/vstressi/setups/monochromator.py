description = 'Monochromator CARESS HWB Devices'

group = 'lowlevel'

devices = dict(
    omgm = device('nicos.devices.generic.VirtualMotor',
        description = 'Simulated OMGM',
        fmtstr = '%.2f',
        unit = 'deg',
        abslimits = (-200, 200),
        speed = 1,
    ),
    transm_m = device('nicos.devices.generic.VirtualMotor',
        description = 'Simulated TRANSM',
        fmtstr = '%.2f',
        unit = 'mm',
        abslimits = (-200, 200),
        lowlevel = True,
        curvalue = 60.292,
        speed = 3,
    ),
    transm = device('nicos.devices.generic.Switcher',
        description = 'Monochromator changer',
        moveable = 'transm_m',
        mapping = {'Si': 0.292, 'PG': 30.292, 'Ge': 60.292,},
        # requires = {'level': 'admin'},
        precision = 0.01,
        unit = '',
    ),
    tthm_r = device('nicos_mlz.stressi.devices.wavelength.TransformedMoveable',
        description = 'Base hardware device',
        dev = 'tthm',
        informula = '1./0.956 * x - 11.5 / 0.956',
        outformula = '0.956 * x + 11.5',
        precision = 0.001,
        lowlevel = True,
    ),
    tthm = device('nicos.devices.generic.VirtualMotor',
        description = 'virtual TTHM',
        fmtstr = '%.2f',
        unit = 'deg',
        abslimits = (50, 100),
        curvalue = 86.,
        speed = 2,
    ),
    wav = device('nicos_mlz.stressi.devices.wavelength.Wavelength',
        description = 'The incoming wavelength',
        omgm = 'omgm',
        crystal = 'transm',
        plane = '311',  # '100',
        base = 'tthm_r',
        unit = 'AA',
        fmtstr = '%.2f',
        abslimits = (0.9, 2.5),
    ),
)
