# -*- coding: utf-8 -*-

description = "Virtual collimation setup"
group = "lowlevel"

COLLIMATION_PRESETS = {
    '2m (30x30)':  dict(guides=2,  ap_x=30, ap_y=30),
    '4m (30x30)':  dict(guides=4,  ap_x=30, ap_y=30),
    '8m (30x30)':  dict(guides=8,  ap_x=30, ap_y=30),
    '14m (30x30)': dict(guides=14, ap_x=30, ap_y=30),
    '20m (30x30)': dict(guides=20, ap_x=30, ap_y=30),
    '2m (50x50)':  dict(guides=2,  ap_x=50, ap_y=50),
    '4m (50x50)':  dict(guides=4,  ap_x=50, ap_y=50),
}

devices = dict(
    collimation = device('kws1.collimation.Collimation',
                         description = 'high-level collimation device',
                         mapping = dict((k, (v['guides'], v['ap_x'], v['ap_y']))
                                        for (k, v) in COLLIMATION_PRESETS.items()),
                         guides = 'coll_guides',
                         slitpos = [2, 4, 8, 14, 20],
                         slits = ['aperture_02',
                                  'aperture_04',
                                  'aperture_08',
                                  'aperture_14',
                                  'aperture_20'],
                        ),

    coll_guides = device('devices.generic.VirtualMotor',
                         description = 'positioning of the neutron guide elements',
                         unit = 'm',
                         abslimits = (2, 20),
                         precision = 0,
                         speed = 1,
                        ),

    aperture_20_x = device("devices.generic.VirtualMotor",
                           description = "20m aperture horizontal opening",
                           unit = "mm",
                           abslimits = (0, 50),
                           precision = 0.02,
                           speed = 5,
                           lowlevel = True,
                          ),
    aperture_20_y = device("devices.generic.VirtualMotor",
                           description = "20m aperture vertical opening",
                           unit = "mm",
                           abslimits = (0, 50),
                           precision = 0.02,
                           speed = 5,
                           lowlevel = True,
                          ),
    aperture_20   = device("devices.generic.TwoAxisSlit",
                           description = "20m aperture",
                           horizontal = "aperture_20_x",
                           vertical = "aperture_20_y",
                           fmtstr = "%.1f x %.1f",
                          ),

    aperture_14_x = device("devices.generic.VirtualMotor",
                           description = "14m aperture horizontal opening",
                           unit = "mm",
                           abslimits = (0, 50),
                           precision = 0.02,
                           speed = 5,
                           lowlevel = True,
                          ),
    aperture_14_y = device("devices.generic.VirtualMotor",
                           description = "14m aperture vertical opening",
                           unit = "mm",
                           abslimits = (0, 50),
                           precision = 0.02,
                           speed = 5,
                           lowlevel = True,
                          ),
    aperture_14   = device("devices.generic.TwoAxisSlit",
                           description = "14m aperture",
                           horizontal = "aperture_14_x",
                           vertical = "aperture_14_y",
                           fmtstr = "%.1f x %.1f",
                          ),

    aperture_08_x = device("devices.generic.VirtualMotor",
                           description = "8m aperture horizontal opening",
                           unit = "mm",
                           abslimits = (0, 50),
                           precision = 0.02,
                           speed = 3,
                           lowlevel = True,
                          ),
    aperture_08_y = device("devices.generic.VirtualMotor",
                           description = "8m aperture vertical opening",
                           unit = "mm",
                           abslimits = (0, 50),
                           precision = 0.02,
                           speed = 3,
                           lowlevel = True,
                          ),
    aperture_08   = device("devices.generic.TwoAxisSlit",
                           description = "8m aperture",
                           horizontal = "aperture_08_x",
                           vertical = "aperture_08_y",
                           fmtstr = "%.1f x %.1f",
                          ),

    aperture_04_x = device("devices.generic.VirtualMotor",
                           description = "4m aperture horizontal opening",
                           unit = "mm",
                           abslimits = (0, 50),
                           precision = 0.02,
                           speed = 5,
                           lowlevel = True,
                          ),
    aperture_04_y = device("devices.generic.VirtualMotor",
                           description = "4m aperture vertical opening",
                           unit = "mm",
                           abslimits = (0, 50),
                           precision = 0.02,
                           speed = 5,
                           lowlevel = True,
                          ),
    aperture_04   = device("devices.generic.TwoAxisSlit",
                           description = "4m aperture",
                           horizontal = "aperture_04_x",
                           vertical = "aperture_04_y",
                           fmtstr = "%.1f x %.1f",
                          ),

    aperture_02_x = device("devices.generic.VirtualMotor",
                           description = "2m aperture horizontal opening",
                           unit = "mm",
                           abslimits = (0, 50),
                           precision = 0.02,
                           speed = 5,
                           lowlevel = True,
                          ),
    aperture_02_y = device("devices.generic.VirtualMotor",
                           description = "2m aperture vertical opening",
                           unit = "mm",
                           abslimits = (0, 50),
                           precision = 0.02,
                           speed = 5,
                           lowlevel = True,
                          ),
    aperture_02   = device("devices.generic.TwoAxisSlit",
                           description = "2m aperture",
                           horizontal = "aperture_02_x",
                           vertical = "aperture_02_y",
                           fmtstr = "%.1f x %.1f",
                          ),
)
