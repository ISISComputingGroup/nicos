description = 'virtual PGAA devices'
group = 'basic'

excludes = ['qmchannel']

sysconfig = dict(
    datasinks = ['sink']
)

devices = dict(
    samplerot = device('nicos.devices.generic.VirtualMotor',
                       description = 'Motor to change the sample position',
                       fmtstr = '%7.1f',
                       abslimits = (-5, 365),
                       speed = 10,
                       unit = 'deg',
                       lowlevel = True,
                      ),
    samplemotor = device('nicos.devices.generic.MultiSwitcher',
                         description = 'Sample switcher',
                         moveables = ['samplerot'],
                         mapping  = {1: [0.0],
                                     2: [22.5],
                                     3: [45.0],
                                     4: [67.5],
                                     5: [90.0],
                                     6: [112.5],
                                     7: [135.0],
                                     8: [157.5],
                                     9: [180.0],
                                     10: [202.5],
                                     11: [225.0],
                                     12: [247.5],
                                     13: [270.0],
                                     14: [292.5],
                                     15: [315.0],
                                     16: [337.5],
                                    },
                         precision = [0.1],
                         blockingmove = False,
                         unit = '',
                         fmtstr = '%d',
                        ),
    push = device('nicos.devices.generic.ManualSwitch',
                  description = 'Push sample up and down',
                  states = ['up', 'down'],
                 ),
    ellcol = device('nicos_mlz.pgaa.devices.ellcol.EllCol',
                    description = 'Switches between focused and collimated Beam',
                    ellipse = device('nicos.devices.generic.ManualSwitch',
                                     states = [0, 1],
                                    ),
                    collimator = device('nicos.devices.generic.ManualSwitch',
                                        states = [0, 1],
                                       ),
                    unit = ''
                   ),
    shutter = device('nicos.devices.generic.ManualSwitch',
                     description = 'secondary experiment shutter',
                     states = ['open', 'closed'],
                    ),
    attenuator = device('demo.attenuator.Attenuator',
                        description = 'Attenuator',
                        blades = ['att1', 'att2', 'att3'],
                       ),
    att1 = device('nicos.devices.generic.ManualSwitch',
                  description = 'attenuator 1',
                  states = ['in', 'out'],
                 ),
    att2 = device('nicos.devices.generic.ManualSwitch',
                  description = 'attenuator 2',
                  states = ['in', 'out'],
                 ),
    att3 = device('nicos.devices.generic.ManualSwitch',
                  description = 'attenuator 3',
                  states = ['in', 'out'],
                 ),
    att = device('nicos_mlz.pgaa.devices.attenuator.Attenuator',
                 description = 'Attenuator device',
                 moveables = ['att1', 'att2', 'att3'],
                 readables = None,
                 precision = None,
                 unit = '%',
                 fmtstr = '%.1f',
                 mapping = {100.: ('out', 'out', 'out'),
                            47.: ('out', 'in', 'out'),
                            16.: ('in', 'out', 'out'),
                            7.5: ('in', 'in', 'out'),
                            5.9: ('out', 'out', 'in'),
                            3.5: ('out', 'in', 'in'),
                            2.7: ('in', 'out', 'in'),
                            1.6: ('in', 'in', 'in'),
                           },
                ),
    chamber_pressure = device('nicos.devices.generic.VirtualMotor',
                              description = 'Chamber pressure',
                              jitter = 1.0,
                              abslimits = (0, 1000),
                              unit = 'mbar',
                             ),
    det = device('nicos_mlz.pgaa.devices.dspecdemo.DSPec',
                 description = 'DSpec Tango Device',
                 prefix = 'P'
                ),
    detLEGe = device('nicos_mlz.pgaa.devices.dspecdemo.DSPec',
                     description = 'DSpec Tango Device',
                     prefix = 'L'
                    ),
    sink = device('nicos_mlz.pgaa.devices.datasinks.PGAASink',
                  lowlevel = True,
                  settypes = set(['scan']),
                  det1 = 'det',
                  det2 = 'detLEGe',
                  vac = 'chamber_pressure',
                 ),
)

startupcode = '''
# SetDetectors(det)
SetEnvironment()
printinfo("============================================================")
printinfo("Welcome to the NICOS PGAA demo setup.")
printinfo("============================================================")
'''
