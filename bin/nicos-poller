#!/usr/bin/env python

import sys, os
from os import path
thisfile = path.abspath(__file__)
while path.islink(thisfile):
    thisfile = path.join(path.dirname(thisfile), os.readlink(thisfile))
sys.path.insert(0, path.normpath(path.dirname(thisfile) + '/..'))

import optparse
from nicos.services.poller.psession import PollerSession

parser = optparse.OptionParser()
parser.add_option('-d', '--daemon', dest='daemon', action='store_true',
                  help='daemonize the poller processes')
parser.add_option('-S', '--setup', action='store', dest='setupname',
                  default='poller',
                  help="name of the setup, default is 'poller'")
opts, args = parser.parse_args()

if len(args) > 0:
    appname = 'poller-' + args[0]
else:
    appname = 'poller'

PollerSession.run(appname, setupname=opts.setupname, maindevname='Poller',
                  start_args=args, daemon=opts.daemon)
