#!/usr/bin/env python

import sys, os
from os import path
thisfile = path.abspath(__file__)
while path.islink(thisfile):
    thisfile = path.join(path.dirname(thisfile), os.readlink(thisfile))
sys.path.insert(0, path.normpath(path.dirname(thisfile) + '/../lib'))

import optparse
from nicos.utils import nocolor
from nicos.sessions.console import ConsoleSession

# support calling via a symlink with the name of a setup
symname = ''
if path.basename(sys.argv[0]) != 'nicos-console':
    symname = path.basename(sys.argv[0])

parser = optparse.OptionParser()
parser.add_option('-s', '--simulate', dest='simulate', action='store_true',
                  help='start in simulation mode')
parser.add_option('-c', '--nocreate', dest='noautocreate', action='store_true',
                  help='do not autocreate devices')
parser.add_option('-n', '--nocolor', dest='nocolor', action='store_true',
                  help='disable colorization')
opts, args = parser.parse_args()

if opts.nocolor:
    nocolor()

ConsoleSession.autocreate_devices = not opts.noautocreate

ConsoleSession.run(args[0] if args else (symname or 'startup'), opts.simulate)
