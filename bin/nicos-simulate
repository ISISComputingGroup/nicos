#!/usr/bin/env python

import sys
from os import path
sys.path.insert(0, path.dirname(path.dirname(path.realpath(__file__))))

import signal

args = sys.argv[1:]
if len(args) != 5:
    raise SystemExit('Usage: nicos-simulate port prefix setups user code')
port = int(args[0])
prefix = args[1]
setups = args[2].split(',')
user = args[3]
code = args[4]

# kill forcibly after 10 minutes
if hasattr(signal, 'alarm'):
    signal.alarm(600)

from nicos.core.sessions.simulation import SimulationSession
SimulationSession.run(port, prefix, setups, user, code)
