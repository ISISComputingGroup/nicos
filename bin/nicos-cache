#!/usr/bin/env python

import argparse
import sys
from os import path

sys.path.insert(0, path.dirname(path.dirname(path.realpath(__file__))))

from nicos.core.sessions.simple import NoninteractiveSession

parser = argparse.ArgumentParser()
parser.add_argument('-d', '--daemon', dest='daemon', action='store_true',
                    help='daemonize the cache process')
parser.add_argument('-S', '--setup', action='store', dest='setupname',
                    default='cache',
                    help="name of the setup, default is 'cache'")
parser.add_argument('--clear', dest='clear', action='store_true',
                    default=False,
                    help='clear the whole cache')
parser.add_argument('args', nargs=argparse.REMAINDER, help=argparse.SUPPRESS)

opts = parser.parse_args()

if opts.clear:
    opts.args.append('clear')

NoninteractiveSession.run('cache', 'Server', setupname=opts.setupname,
                          daemon=opts.daemon, start_args=opts.args)
