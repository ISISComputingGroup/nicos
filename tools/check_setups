#!/usr/bin/env python

import sys
import traceback

def check_setupfile(name):
    try:
        execfile(name, {'device': lambda c, **kw: (c, kw)})
        print '%s ... ok' % (name, )
        return True
    except SyntaxError, e:
        print '%s ... not ok' % (e.filename, )
        print 'SyntaxError: %s' % (e.msg, )
        print ' line %d : %s' % (e.lineno, e.text, )
        return False
    except Exception, e:
        print '%s ... not ok' % (name, )
        formatted_lines = traceback.format_exc().splitlines()
        print formatted_lines[-3]
        print formatted_lines[-1]
        print formatted_lines[-2]
        return False

ret = True
for i in sys.argv[1:]:
    ret = ret and check_setupfile(i)

sys.exit(not ret)
