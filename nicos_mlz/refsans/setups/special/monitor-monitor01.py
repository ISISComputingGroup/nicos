# coding: utf-8

description = 'Chopper Monitor'
group = 'special'

# Legend for _chconfigcol
# dev = '...' represents here only the possible values, no devices

# Legend for the chopper discs
# speed  = Revolutions per minute
# angle  = Angle
# phase  = Disk Phases
# gear   = Speed Factor
# status = Error Status

_chopperpar = Column(
    Block(' Chopper Configuration ', [ # This block contains the parameters set thorugh chopper_config
        BlockRow(
            Field(name=u'\u03bb\u2098\u1d62\u2099', key='chopper/wlmin', width=14, format = '%.1f', unit=u'(\u212b)'),
            Field(name=u'\u03bb\u2098\u2090\u2093', key='chopper/wlmax', width=14, format = '%.1f', unit=u'(\u212b)'),
            Field(name='Disk 2 Position', key='chopper/resolution', width=14, unit='(1 - 6)'), # it is not the resolution by itsself. It is the disk 2 position set in chopper_config
            Field(name='Disk 1 - Detector Distance', key='chopper/dist', width=14, format = '%.3f', unit='(m)'),
            Field(name='gap', key='chopper/gap', width=10, format = '%.2f',),
            ),
        BlockRow(
            Field(name='Disk 2 Phase', key='chopper2/phase', width=10, format = '%.2f', unit='(deg)'),
            Field(name='Disk 3 Phase', key='chopper3/phase', width=10, format = '%.2f', unit='(deg)'),
            Field(name='Disk 4 Phase', key='chopper4/phase', width=10, format = '%.2f', unit='(deg)'),
            Field(name='Disk 5 Phase', key='chopper5/phase', width=10, format = '%.2f', unit='(deg)'),
            Field(name='Disk 6 Phase', key='chopper6/phase', width=10, format = '%.2f', unit='(deg)'),
         ),
        ],
    ),
    Block(' Chopper Settings ', [ # This block contains the actual parameters set for the chopper system
         BlockRow(
            #Field(name='Angular Speed', dev='chopper_speed', width=10, format = '%.1f', unit='(rpm)'),
            Field(name='Angular Speed', dev='cpt1', width=10, format = '%.1f', unit='(rpm)'),
            Field(name='Disk 2 Mode', key='chopper/mode', width=20),
            Field(name='Disk 2 Position', dev='chopper2_pos', width=10, unit='(1 - 5)'),
            Field(name='Disc1 - Detector Distance', dev='real_flight_path', width=14, format = '%.3f', unit='(m)'), # it is not the flight path. I don't know why somebody called it real_flight_path
            Field(name=u'Resolution \u0394\u03bb/\u03bb ', dev='resolution', width=14, format = '%.2f', unit='(%)'),
            Field(name='Start Delay', key='chopper/delay', width=10, format = '%.2f', unit='(deg)'),
            #Field(name='Fatal', key='chopper/fatal', width=10),
            ),
         BlockRow(
            #Field(name='disk 2 Phase', key='chopper2/phase', width=10, format = '%.2f', unit='(deg)'),
            #Field(name='disk 3 Phase', key='chopper3/phase', width=10, format = '%.2f', unit='(deg)'),
            #Field(name='disk 4 Phase', key='chopper4/phase', width=10, format = '%.2f', unit='(deg)'),
            #Field(name='disk 5 Phase', key='chopper5/phase', width=10, format = '%.2f', unit='(deg)'),
            #Field(name='disk 6 Phase', key='chopper6/phase', width=10, format = '%.2f', unit='(deg)'),
            Field(name='Disk 2 Phase', dev='cpt2', width=10, format = '%.2f', unit='(deg)'),
            Field(name='Disk 3 Phase', dev='cpt3', width=10, format = '%.2f', unit='(deg)'),
            Field(name='Disk 4 Phase', dev='cpt4', width=10, format = '%.2f', unit='(deg)'),
            Field(name='Disk 5 Phase', dev='cpt5', width=10, format = '%.2f', unit='(deg)'),
            Field(name='Disk 6 Phase', dev='cpt6', width=10, format = '%.2f', unit='(deg)'),
         )
        ],
    ),
)

# The time-distance diagram is generated by chopperconfig as a png image and should then be
# displayed. Width and height must be adjusted but they don't work in the actual configuration

_tididiagcol = Column(
    Block(' Time/Distance Diagram', [
        BlockRow(
            Field(widget='nicos_mlz.refsans.gui.monitorwidgets.TimeDistance',
                  chopper1='chopper_speed', disc2_pos='chopper2_pos'),
                  # width=30, height=11),
            ),
        ],
    ),
)


devices = dict(
    Monitor = device('nicos.services.monitor.qt.Monitor',
        title = description,
        loglevel = 'info',
        cache = 'refsansctrl.refsans.frm2.tum.de',
        prefix = 'nicos/',
        font = 'Luxi Sans',
        valuefont = 'Consolas',
        fontsize = 12,
        padding = 5,
        layout = [
            Row(_chopperpar),
            Row(_tididiagcol)
        ],
    ),
)
