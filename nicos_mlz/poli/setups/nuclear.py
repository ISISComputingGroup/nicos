description = 'nuclear physics setup'

group = 'basic'

taco_base = '//cryopad.poli.frm2/heidi2/'
tango_base = 'tango://phys.poli.frm2:10000/poli/'

modules = ['nicos.commands.standard', 'nicos_mlz.poli.nuclear_commands', 'nicos_mlz.poli.devices.amplscan']

excludes = ['detector', 'zeadetector', 'cryopad_currents']

devices = dict(
    nutator1c = device('nicos.devices.taco.CurrentSupply',
        description = 'Nutator 1 current',
        tacodevice = taco_base + 'nutator1/current',
        fmtstr = '%.2f',
        abslimits = (-3, 3),
        unit = 'A',
        pollinterval = 60,
        maxage = 65,
    ),
    nutator2c = device('nicos.devices.taco.CurrentSupply',
        description = 'Nutator 2 current',
        tacodevice = taco_base + 'nutator2/current',
        fmtstr = '%.2f',
        abslimits = (-3, 3),
        unit = 'A',
        pollinterval = 60,
        maxage = 65,
    ),
    nutax = device('nicos.devices.taco.CurrentSupply',
        description = 'Nutator axial current',
        tacodevice = taco_base + 'nutax12/current',
        fmtstr = '%.2f',
        abslimits = (0, 3),
        unit = 'A',
        pollinterval = 60,
        maxage = 65,
    ),
    pc1 = device('nicos.devices.taco.CurrentSupply',
        description = 'Precession coil 1 current',
        tacodevice = taco_base + 'pc1/current',
        fmtstr = '%.3f',
        abslimits = (-5, 5),
        unit = 'A',
        pollinterval = 60,
        maxage = 65,
    ),
#    decpolcorr1 = device('nicos.devices.taco.CurrentSupply',
#        description = 'Detector polarizer correction current 1',
#        tacodevice = taco_base + 'decpolcorr1/current',
#        fmtstr = '%.2f',
#        abslimits = (0, 2),
#        unit = 'A',
#        pollinterval = 60,
#        maxage = 65,
#    ),
#    decpolcorr2 = device('nicos.devices.taco.CurrentSupply',
#        description = 'Detector polarizer correction current 2',
#        tacodevice = taco_base + 'decpolcorr2/current',
#        fmtstr = '%.2f',
#        abslimits = (0, 2),
#        unit = 'A',
#        pollinterval = 60,
#        maxage = 65,
#    ),
#    decpolmain = device('nicos.devices.taco.CurrentSupply',
#        description = 'Detector polarizer main current',
#        tacodevice = taco_base + 'decpolmain/current',
#        fmtstr = '%.2f',
#        unit = 'A',
#        pollinterval = 10,
#        maxage = 15,
#        abslimits = (0, 2),
#    ),
    polarmain = device('nicos.devices.taco.CurrentSupply',
        description = 'Polarizer main current',
        tacodevice = taco_base + 'polarmain/current',
        fmtstr = '%.2f',
        abslimits = (0, 2),
        unit = 'A',
        pollinterval = 60,
        maxage = 65,
    ),
    polarcorr1 = device('nicos.devices.taco.CurrentSupply',
        description = 'Polarizer correction current 1',
        tacodevice = taco_base + 'polarbeam/current',
        fmtstr = '%.2f',
        abslimits = (0, 2),
        unit = 'A',
        pollinterval = 60,
        maxage = 65,
    ),
#    polarcorr2 = device('nicos.devices.taco.CurrentSupply',
#        description = 'Polarizer correction current 2',
#        tacodevice = taco_base + 'polarnut/current',
#        fmtstr = '%.2f',
#        abslimits = (0, 2),
#        unit = 'A',
#        pollinterval = 60,
#        maxage = 65,
#    ),

#    pcflipper = device('nicos.devices.polarized.MezeiFlipper',
#        description = 'Mezei flipper using pc1 and pc2 supplies',
#        flip = 'pc1',
#        corr = 'pc2',
#    ),

    timer = device('nicos.devices.tango.TimerChannel',
        tangodevice = tango_base + 'frmctr/timer',
        fmtstr = '%.2f',
        lowlevel = True,
    ),
    ctr1 = device('nicos.devices.tango.CounterChannel',
        tangodevice = tango_base + 'frmctr/ctr0',
        type = 'counter',
        fmtstr = '%d',
        lowlevel = True,
    ),
    mon1 = device('nicos.devices.tango.CounterChannel',
        tangodevice = tango_base + 'frmctr/ctr1',
        type = 'monitor',
        fmtstr = '%d',
        lowlevel = True,
    ),
    ctr2 = device('nicos.devices.tango.CounterChannel',
        tangodevice = tango_base + 'frmctr/ctr2',
        type = 'counter',
        fmtstr = '%d',
        lowlevel = True,
    ),
    mon2 = device('nicos.devices.tango.CounterChannel',
        tangodevice = tango_base + 'frmctr/ctr3',
        type = 'monitor',
        fmtstr = '%d',
        lowlevel = True,
    ),
    det = device('nicos.devices.generic.Detector',
        description = 'counter card',
        timers = ['timer'],
        monitors = ['mon1', 'mon2'],
        counters = ['ctr1', 'ctr2'],
        maxage = 2,
        pollinterval = 1.0,
    ),

    scandet = device('nicos_mlz.poli.devices.amplscan.ScanningDetector',
        description = 'scanning detector for amplitude scan',
        detector = 'det',
    ),

#    adet = device('nicos_mlz.poli.devices.detector.AsymDetector',
#        description = 'detector that automatically counts up and down states',
#        detector = 'det',
#        flipper = 'flipper',
#        flipvalues = ('off', 'on'),
#        counter = 'ctr1',
#    ),
#
#    flipper = device('nicos.devices.generic.DeviceAlias',
#        devclass = 'nicos.core.device.Moveable',
#    ),
)

startupcode = '''
SetDetectors(det)
'''
