description = 'Monochromator CARESS HWB Devices'

group = 'lowlevel'

servername = 'VME'

nameservice = 'stressictrl.stressi.frm2'

devices = dict(
    omgm = device('nicos.devices.vendor.caress.EKFMotor',
                  description = 'HWB OMGM',
                  fmtstr = '%.2f',
                  unit = 'deg',
                  abslimits = (-360, 360),
                  userlimits = (-200, 200),
                  nameserver = '%s' % (nameservice,),
                  objname = '%s' % (servername),
                  config = 'OMGM 114 11 0x00f1e000 2 4096 2000 200 2 24 50 1 0 1 3000 1 10 0 0 0',
                  requires =  {'level': 'admin',},
                 ),
    transm_m = device('nicos.devices.vendor.caress.EKFMotor',
                      description = 'HWB TRANSM',
                      fmtstr = '%.3f',
                      unit = 'cm',
                      abslimits = (-360, 360),
                      userlimits = (-200, 200),
                      nameserver = '%s' % (nameservice,),
                      objname = '%s' % (servername),
                      config = 'TRANSM 114 11 0x00f1e000 4 204800 10000 1000 2 24 50 1 0 1 3000 1 10 0 0 0',
                      lowlevel = True,
                      requires =  {'level': 'admin',},
                     ),
    transm = device('nicos.devices.generic.Switcher',
                    description = 'Monochromator changer',
                    moveable = 'transm_m',
                    mapping = {'Si': 0.292, 'PG': 30.292, 'Ge': 60.292,},
                    precision = 0.01,
                    unit = '',
                    requires =  {'level': 'admin',},
                   ),
#   tthm = device('nicos.devices.vendor.caress.EKFMotor',
    tthm = device('nicos.devices.generic.ManualMove',
                  description = 'Take off angle',
                  default = 84.0,
#                 nameserver = '%s' % (nameservice,),
#                 objname = '%s' % (servername),
#                 config = 'TTHM 115 11 0xf0f1f000 4 20600 512 32 1 0 0'
#                          ' 0 0 1 5000 10 50 0 0',
                  fmtstr = '%.2f',
                  unit = 'deg',
                  abslimits = (50., 100.),
                 ),
    tthm_r = device('nicos_mlz.stressi.devices.wavelength.TransformedMoveable',
                    description = 'Base hardware device',
                    dev = 'tthm',
                    informula = '1./0.956 * x - 11.5 / 0.956',
                    outformula = '0.956 * x + 11.5',
                    precision = 0.001,
                    lowlevel = True,
                   ),
    wav = device('nicos_mlz.stressi.devices.wavelength.Wavelength',
                 description = 'The incoming wavelength',
                 omgm = 'omgm',
                 crystal = 'transm',
                 base = 'tthm_r',
                 plane = '100',
                 unit = 'AA',
                 fmtstr = '%.2f',
                 abslimits = (0.9, 2.5),
                 requires =  {'level': 'admin',},
                ),
)
