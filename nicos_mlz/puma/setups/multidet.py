#  -*- coding: utf-8 -*-

description = 'Multidetector motors'

includes = ['system', 'motorbus10']

excludes = ['detectorM', 'detector']

group = 'optional'

modules = ['nicos_mlz.puma.commands']

nethost = 'pumasrv.puma.frm2'

inner_slope = 4061.72
outer_slope = 4709.53
rg_slope = -948
refstep_d = 500
refstep_g = 100

devices = dict(
# Detectors
    st_rd11 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 71,
        slope = inner_slope,
        unit = 'deg',
        abslimits = (-39, -13),
        refpos = 343173, # -38.611, 656827, 500000,
        zerosteps = 500000,
        refswitch = 'high',
        refdirection = 'lower',
        refstep = refstep_d,
        lowlevel = True,
    ),
    st_rd10 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 73,
        slope = outer_slope,
        unit = 'deg',
        abslimits = (-37, -10.6),
        refpos = 329524, # -36.198, 670476, 500000,
        zerosteps = 500000,
        refswitch = 'high',
        refdirection = 'lower',
        refstep = refstep_d,
        lowlevel = True,
    ),
    st_rd9 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 75,
        slope = inner_slope,
        unit = 'deg',
        abslimits = (-34, -8.2),
        refpos = 363031, # -33.722, 636969, 500000,
        zerosteps = 500000,
        refswitch = 'high',
        refdirection = 'lower',
        refstep = refstep_d,
        lowlevel = True,
    ),
    st_rd8 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 77,
        slope = outer_slope,
        unit = 'deg',
        abslimits = (-31.5, -5.8),
        refpos = 352794, # -31.257, 647206, 500000,
        zerosteps = 500000,
        refswitch = 'high',
        refdirection = 'lower',
        refstep = refstep_d,
        lowlevel = True,
    ),
    st_rd7 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 79,
        slope = inner_slope,
        unit = 'deg',
        abslimits = (-29, -3.4),
        refpos = 382243, # -28.992, 500000, # 617757,
        zerosteps = 500000,
        refswitch = 'high',
        refdirection = 'lower',
        refstep = refstep_d,
        lowlevel = True,
    ),
    st_rd6 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 81,
        slope = outer_slope,
        unit = 'deg',
        abslimits = (-27, -1),
        refpos = 375202, # -26.499, 500000, # 624798,
        zerosteps = 500000,
        refswitch = 'high',
        refdirection = 'lower',
        refstep = refstep_d,
        lowlevel = True,
    ),
    st_rd5 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 83,
        slope = inner_slope,
        unit = 'deg',
        abslimits = (-24.5, 1.4),
        refpos = 402348, # -24.042, 500000, # 597652,
        zerosteps = 500000,
        refswitch = 'high',
        refdirection = 'lower',
        refstep = refstep_d,
        lowlevel = True,
    ),
    st_rd4 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 85,
        slope = outer_slope,
        unit = 'deg',
        abslimits = (-22, 3.8),
        refpos = 398030, # -21.6518,  500000, # 601970,
        zerosteps = 500000,
        refswitch = 'high',
        refdirection = 'lower',
        refstep = refstep_d,
        lowlevel = True,
    ),
    st_rd3 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 87,
        slope = inner_slope,
        unit = 'deg',
        refpos = 422161, # -19.164, 500000, # 577839,
        abslimits = (-19.5, 6.2),
        zerosteps = 500000,
        refswitch = 'high',
        refdirection = 'lower',
        refstep = refstep_d,
        lowlevel = True,
    ),
    st_rd2 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 89,
        slope = outer_slope,
        unit = 'deg',
        abslimits = (-17, 8.6),
        refpos = 420611, # -16.857, 500000, # 579389,
        zerosteps = 500000,
        # The card has firmware version 65 instead of 58 and it seems that the
        # limit switch order has been changed
        refswitch = 'high',
        refdirection = 'lower',
        refstep = refstep_d,
        lowlevel = True,
    ),
    st_rd1 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 91,
        slope = inner_slope,
        unit = 'deg',
        abslimits = (-15, 11),
        refpos = 441625, # -14.372, 500000, # 558375
        zerosteps = 500000,
        # The card has firmware version 65 instead of 58 and it seems that the
        # limit switch order has been changed
        refswitch = 'high',  # 'high',
        refdirection = 'lower',
        refstep = refstep_d,
        lowlevel = True,
    ),
    rd11 = device('nicos.devices.generic.Axis',
        description = 'Detector 11 position',
        motor = 'st_rd11',
        obs = [],
        precision = 0.01,
        offset = 0, # 38.611, # 0
        maxtries = 1,
    ),
    rd10 = device('nicos.devices.generic.Axis',
        description = 'Detector 10 position',
        motor = 'st_rd10',
        obs = [],
        precision = 0.01,
        offset = 0, # 36.198, # 0
        maxtries = 1,
    ),
    rd9 = device('nicos.devices.generic.Axis',
        description = 'Detector 9 position',
        motor = 'st_rd9',
        obs = [],
        precision = 0.01,
        offset = 0, # 33.722, # 0
        maxtries = 1,
    ),
    rd8 = device('nicos.devices.generic.Axis',
        description = 'Detector 8 position',
        motor = 'st_rd8',
        obs = [],
        precision = 0.01,
        offset = 0, # 31.257, # 0
        maxtries = 1,
    ),
    rd7 = device('nicos.devices.generic.Axis',
        description = 'Detector 7 position',
        motor = 'st_rd7',
        obs = [],
        precision = 0.01,
        offset = 0, # 28.892,
        maxtries = 1,
    ),
    rd6 = device('nicos.devices.generic.Axis',
        description = 'Detector 6 position',
        motor = 'st_rd6',
        obs = [],
        precision = 0.01,
        offset = 0, # 26.499, # 0
        maxtries = 1,
    ),
    rd5 = device('nicos.devices.generic.Axis',
        description = 'Detector 5 position',
        motor = 'st_rd5',
        obs = [],
        precision = 0.01,
        offset = 0, # 24.042, # 0
        maxtries = 1,
    ),
    rd4 = device('nicos.devices.generic.Axis',
        description = 'Detector 4 position',
        motor = 'st_rd4',
        obs = [],
        precision = 0.01,
        offset = 0, # 21.652, # 0
        maxtries = 1,
    ),
    rd3 = device('nicos.devices.generic.Axis',
        description = 'Detector 3 position',
        motor = 'st_rd3',
        obs = [],
        precision = 0.01,
        offset = 0, # 19.164, # 0
        maxtries = 1,
    ),
    rd2 = device('nicos.devices.generic.Axis',
        description = 'Detector 2 position',
        motor = 'st_rd2',
        obs = [],
        precision = 0.01,
        offset = 0, # 16.857, # 0
        maxtries = 1,
    ),
    rd1 = device('nicos.devices.generic.Axis',
        description = 'Detector 1 position',
        motor = 'st_rd1',
        obs = [],
        precision = 0.01,
        offset = 0, # 14.372, # 0
        maxtries = 1,
    ),

# Guides
    st_rg11 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 72,
        slope = rg_slope,
        unit = 'deg',
        abslimits = (-8, 25),
        refpos = 506892, # -7.27, 500000, 7576,
        zerosteps = 500000,
        refswitch = 'low',
        refstep = refstep_g,
        lowlevel = True,
    ),
    st_rg10 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 74,
        slope = rg_slope,
        unit = 'deg',
        abslimits = (-8, 25),
        refpos = 506864, # -7.24, 500000, 7529,
        zerosteps = 500000,
        refswitch = 'low',
        refstep = refstep_g,
        lowlevel = True,
    ),
    st_rg9 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 76,
        slope = rg_slope,
        unit = 'deg',
        abslimits = (-8, 25),
        refpos = 506759, # -7.13, 500000, 7520,
        zerosteps = 500000,
        refswitch = 'low',
        refstep = refstep_g,
        lowlevel = True,
    ),
    st_rg8 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 78,
        slope = rg_slope,
        unit = 'deg',
        abslimits = (-8, 25),
        refpos = 506740, # -7.11, 500000, 7534,
        zerosteps = 500000,
        refswitch = 'low',
        refstep = refstep_g,
        lowlevel = True,
    ),
    st_rg7 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 80,
        slope = rg_slope,
        unit = 'deg',
        abslimits = (-8, 25),
        refpos = 506958, # -7.34, 500000, 7620,
        zerosteps = 500000,
        refswitch = 'low',
        refstep = refstep_g,
        lowlevel = True,
    ),
    st_rg6 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 82,
        slope = rg_slope,
        unit = 'deg',
        abslimits = (-8, 25),
        refpos = 506845, # -7.22, 500000, 7516,
        zerosteps = 500000,
        refswitch = 'low',
        refstep = refstep_g,
        lowlevel = True,
    ),
    st_rg5 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 84,
        slope = rg_slope,
        unit = 'deg',
        abslimits = (-8, 25),
        refpos = 507025, # -7.41, 500000, 7552,
        zerosteps = 500000,
        refswitch = 'low',
        refstep = refstep_g,
        lowlevel = True,
    ),
    st_rg4 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 86,
        slope = rg_slope,
        unit = 'deg',
        abslimits = (-8, 25),
        refpos = 506655, # -7.02, 500000, 7578,
        zerosteps = 500000,
        refswitch = 'low',
        refstep = refstep_g,
        lowlevel = True,
    ),
    st_rg3 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 88,
        slope = rg_slope,
        unit = 'deg',
        abslimits = (-8, 25),
        refpos = 506674, # -7.04, 500000, 7518,
        zerosteps = 500000,
        refswitch = 'low',
        refstep = refstep_g,
        lowlevel = True,
    ),
    st_rg2 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 90,
        slope = rg_slope,
        unit = 'deg',
        refpos = 506892, # -7.27, 500000, 7591,
        abslimits = (-8, 25),
        zerosteps = 500000,
        refswitch = 'low',
        refstep = refstep_g,
        lowlevel = True,
    ),
    st_rg1 = device('nicos_mlz.puma.devices.ipc_puma.ReferenceMotor',
        bus = 'motorbus10',
        addr = 92,
        slope = rg_slope,
        unit = 'deg',
        refpos = 507328, # -7.73, 500000, 7550,
        abslimits = (-8, 25),
        zerosteps = 500000,
        refswitch = 'low',
        refstep = refstep_g,
        lowlevel = True,
    ),
    rg11 = device('nicos.devices.generic.Axis',
        description = 'Rotation of the detector 11 guide',
        motor = 'st_rg11',
        obs = [],
        precision = 0.01,
        offset = 0, # 7.27,
        maxtries = 1,
    ),
    rg10 = device('nicos.devices.generic.Axis',
        description = 'Rotation of the detector 10 guide',
        motor = 'st_rg10',
        obs = [],
        precision = 0.01,
        offset = 0, # 7.24,
        maxtries = 1,
    ),
    rg9 = device('nicos.devices.generic.Axis',
        description = 'Rotation of the detector 9 guide',
        motor = 'st_rg9',
        obs = [],
        precision = 0.01,
        offset = 0, # 7.13,
        maxtries = 1,
    ),
    rg8 = device('nicos.devices.generic.Axis',
        description = 'Rotation of the detector 8 guide',
        motor = 'st_rg8',
        obs = [],
        precision = 0.01,
        offset = 0, # 7.11,
        maxtries = 1,
    ),
    rg7 = device('nicos.devices.generic.Axis',
        description = 'Rotation of the detector 7 guide',
        motor = 'st_rg7',
        obs = [],
        precision = 0.01,
        offset = 0, # 7.34,
        maxtries = 1,
    ),
    rg6 = device('nicos.devices.generic.Axis',
        description = 'Rotation of the detector 6 guide',
        motor = 'st_rg6',
        obs = [],
        precision = 0.01,
        offset = 0, # 7.22,
        maxtries = 1,
    ),
    rg5 = device('nicos.devices.generic.Axis',
        description = 'Rotation of the detector 5 guide',
        motor = 'st_rg5',
        obs = [],
        precision = 0.01,
        offset = 0, # 7.41,
        maxtries = 1,
    ),
    rg4 = device('nicos.devices.generic.Axis',
        description = 'Rotation of the detector 4 guide',
        motor = 'st_rg4',
        obs = [],
        precision = 0.01,
        offset = 0, # 7.02,
        maxtries = 1,
    ),
    rg3 = device('nicos.devices.generic.Axis',
        description = 'Rotation of the detector 3 guide',
        motor = 'st_rg3',
        obs = [],
        precision = 0.01,
        offset = 0, # 7.04,
        maxtries = 1,
    ),
    rg2 = device('nicos.devices.generic.Axis',
        description = 'Rotation of the detector 2 guide',
        motor = 'st_rg2',
        obs = [],
        precision = 0.01,
        offset = 0, # 7.27,
        maxtries = 1,
    ),
    rg1 = device('nicos.devices.generic.Axis',
        description = 'Rotation of the detector 1 guide',
        motor = 'st_rg1',
        obs = [],
        precision = 0.01,
        offset = 0, # 7.73,
        maxtries = 1,
    ),
    med = device('nicos_mlz.puma.devices.multidetector.PumaMultiDetectorLayout',
        description = 'PUMA multi detector',
        rotdetector = ['rd1', 'rd2', 'rd3', 'rd4', 'rd5', 'rd6', 'rd7', 'rd8',
                       'rd9', 'rd10', 'rd11'],
        rotguide = ['rg1', 'rg2', 'rg3', 'rg4', 'rg5', 'rg6', 'rg7', 'rg8',
                    'rg9', 'rg10', 'rg11'],
        att = 'att',
    ),
    timer = device('nicos.devices.taco.FRMTimerChannel',
        description = 'QMesyDAQ timer',
        tacodevice = '//%s/puma/qmesydaq/timer' % nethost,
        lowlevel = True,
    ),
    mon1 = device('nicos.devices.taco.FRMCounterChannel',
        description = 'QMesyDAQ monitor 1',
        tacodevice = '//%s/puma/qmesydaq/counter0' % nethost,
        type = 'monitor',
        lowlevel = True,
        fmtstr = '%d',
    ),
    events = device('nicos.devices.vendor.qmesydaq.taco.Counter',
        description = 'QMesyDAQ Events channel',
        tacodevice = '//%s/puma/qmesydaq/events' % nethost,
        type = 'counter',
        lowlevel = True,
        fmtstr = '%d',
    ),
    image = device('nicos.devices.vendor.qmesydaq.taco.Image',
        description = 'QMesyDAQ Image',
        tacodevice = '//%s/puma/qmesydaq/det' % nethost,
        lowlevel = True,
    ),
    multidet = device('nicos.devices.generic.Detector',
        description = 'Puma detector QMesydaq device (3 counters)',
        timers = ['timer'],
        monitors = ['mon1'],
        images = ['image'],
        counters = [],
        maxage = 86400,
        pollinterval = None,
    ),
)
